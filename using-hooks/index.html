<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
  </head>
  <body>
    <div style="display:inline-block">
      <textarea id="line" cols=4 rows=10></textarea>
    </div>
    <div style="display:inline-block">
      <h1>Input</h1>
      <textarea id="input" cols=80 rows=10>
let a, b, d;
a = 1;
b = 2;
let c = 3;
d = 4;

for (let i = 0; i < 4; i++) {
  Console.log(i);
}</textarea>
    </div>

    <div style="display:inline-block">
      <dl id="variables">
      </dl>
    </div>


    <div>
      <button id="run">Run</button>
      <button id="step">Step</button>
      <button id="stop">Stop</button>
    </div>

    <script src="https://unpkg.com/esprima@~4.0/dist/esprima.js"></script>
    <script src="./lang.js"></script>
    <script>
      let $line = document.querySelector("#line");
      let $input = document.querySelector("#input");
      let $variables = document.querySelector("#variables");

      let stepper = Object.create(Stepper);

      const setLine = ln => {
        $line.value = '';
        for (let i = 0; i < ln -1; i++)
          $line.value += '\n';
        $line.value += '->';
      };

      document.querySelector('#run').onclick = function() {
        stepper.run($input.value, {
          Console: console
        });
      };

      document.querySelector('#stop').onclick = function() {
        stepper.clean();
      };

      document.querySelector('#step').onclick = function() {
        const step = stepper.step();
        setLine(step.ln);

        if (typeof step.range !== 'undefined') {
          $input.focus();
          $input.setSelectionRange(...step.range);
          console.log(step);
        }

        if (typeof step.data !== 'undefined') {
          $variables.innerHTML = '';
          for (let variable in step.data) {
            $variables.innerHTML += '<dt>' + variable + '</dt>';
            $variables.innerHTML += '<dd>' + step.data[variable] + '</dd>';
          }
        }
      };
    </script>
  </body>
</html>
